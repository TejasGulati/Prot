<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./weather.component.css">
    <title>Weather Page</title>
</head>
<body>
    <app-navbar></app-navbar>
    <router-outlet></router-outlet>
    <div class="weather-container">
      <div class="weather-header">
          <h2>Weather</h2>
          <form (ngSubmit)="searchWeather()" class="search-form">
              <input id="city" [(ngModel)]="city" name="city" placeholder="Enter city name" required>
              <button type="submit">Search</button>
          </form>
      </div>
  
      <!-- Loader -->
      <div *ngIf="isLoading" class="loader-container">
          <div class="loader"></div>
      </div>
  
      <div *ngIf="!isLoading && weatherData" class="weather-info">
          <div class="weather-image-card">
              <img [src]="getWeatherImage()" alt="Weather Image">
          </div>
          <div class="weather-card">
              <h3>Current Weather</h3>
              <p><strong>City:</strong> {{ weatherData.current.city }}</p>
              <p><strong>Temperature:</strong> {{ weatherData.current.temperature }}°C</p>
              <p><strong>Description:</strong> {{ weatherData.current.description }}</p>
              <p><strong>Humidity:</strong> {{ weatherData.current.humidity }}%</p>
              <p><strong>Wind Speed:</strong> {{ weatherData.current.wind_speed }} m/s</p>
          </div>
  
          <div class="forecast-card">
              <h3>5-Day Forecast</h3>
              <table class="forecast-table">
                  <thead>
                      <tr>
                          <th>Date</th>
                          <th>Temperature</th>
                          <th>Description</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr *ngFor="let day of weatherData.forecast.forecast_data">
                          <td>{{ day.date | date:'short' }}</td>
                          <td>{{ day.temperature }}°C</td>
                          <td>{{ day.description }}</td>
                      </tr>
                  </tbody>
              </table>
          </div>
  
          <div class="air-pollution-card">
              <h3>Air Pollution</h3>
              <p><strong>AQI:</strong> {{ weatherData.air_pollution.aqi }}</p>
              <p><strong>CO:</strong> {{ weatherData.air_pollution.components.co }} μg/m³</p>
              <p><strong>NO:</strong> {{ weatherData.air_pollution.components.no }} μg/m³</p>
              <p><strong>NO2:</strong> {{ weatherData.air_pollution.components.no2 }} μg/m³</p>
              <p><strong>O3:</strong> {{ weatherData.air_pollution.components.o3 }} μg/m³</p>
              <p><strong>SO2:</strong> {{ weatherData.air_pollution.components.so2 }} μg/m³</p>
              <p><strong>PM2.5:</strong> {{ weatherData.air_pollution.components.pm2_5 }} μg/m³</p>
              <p><strong>PM10:</strong> {{ weatherData.air_pollution.components.pm10 }} μg/m³</p>
              <p><strong>NH3:</strong> {{ weatherData.air_pollution.components.nh3 }} μg/m³</p>
          </div>
  
          <!-- AI Insights Section -->
          <div *ngIf="weatherData.ai_insights" class="ai-insights-card">
              <h3>AI Weather Analysis</h3>
              <div class="insights-content">
                  <div *ngFor="let section of aiSections" class="insight-item">
                      <h4>{{ section.title }}</h4>
                      <ng-container [ngSwitch]="section.key">
                          <ng-container *ngSwitchCase="'weather_summary'">
                              <p><strong>Current Conditions:</strong> {{ weatherData.ai_insights.weather_summary.current_conditions }}</p>
                              <p><strong>Temperature Category:</strong> {{ weatherData.ai_insights.weather_summary.temperature_category }}</p>
                              <p><strong>Comfort Level:</strong> {{ weatherData.ai_insights.weather_summary.comfort_level }}</p>
                          </ng-container>
                          <ng-container *ngSwitchCase="'health_recommendations'">
                              <p><strong>Outdoor Activity Score:</strong> {{ weatherData.ai_insights.health_recommendations.outdoor_activity_score }}/10</p>
                              <p><strong>Recommended Activities:</strong></p>
                              <ul>
                                  <li *ngFor="let activity of weatherData.ai_insights.health_recommendations.recommended_activities">{{ activity }}</li>
                              </ul>
                              <p><strong>Health Risks:</strong></p>
                              <ul>
                                  <li *ngFor="let risk of weatherData.ai_insights.health_recommendations.health_risks">{{ risk }}</li>
                              </ul>
                              <p><strong>Precautions:</strong></p>
                              <ul>
                                  <li *ngFor="let precaution of weatherData.ai_insights.health_recommendations.precautions">{{ precaution }}</li>
                              </ul>
                          </ng-container>
                          <ng-container *ngSwitchCase="'air_quality_analysis'">
                              <p><strong>Category:</strong> {{ weatherData.ai_insights.air_quality_analysis.category }}</p>
                              <p><strong>Main Pollutants:</strong></p>
                              <ul>
                                  <li *ngFor="let pollutant of weatherData.ai_insights.air_quality_analysis.main_pollutants">{{ pollutant }}</li>
                              </ul>
                              <p><strong>Health Impact:</strong> {{ weatherData.ai_insights.air_quality_analysis.health_impact }}</p>
                              <p><strong>Recommended Actions:</strong></p>
                              <ul>
                                  <li *ngFor="let action of weatherData.ai_insights.air_quality_analysis.recommended_actions">{{ action }}</li>
                              </ul>
                          </ng-container>
                          <ng-container *ngSwitchCase="'forecast_insights'">
                              <p><strong>Temperature Trend:</strong> {{ weatherData.ai_insights.forecast_insights.temperature_trend }}</p>
                              <p><strong>Weather Pattern:</strong> {{ weatherData.ai_insights.forecast_insights.weather_pattern }}</p>
                              <p><strong>Notable Changes:</strong></p>
                              <ul>
                                  <li *ngFor="let change of weatherData.ai_insights.forecast_insights.notable_changes">{{ change }}</li>
                              </ul>
                              <p><strong>Weekend Outlook:</strong> {{ weatherData.ai_insights.forecast_insights.weekend_outlook }}</p>
                          </ng-container>
                          <ng-container *ngSwitchCase="'travel_recommendations'">
                              <p><strong>Outdoor Activities Suitable:</strong> {{ weatherData.ai_insights.travel_recommendations.outdoor_activities_suitable ? 'Yes' : 'No' }}</p>
                              <p><strong>Best Time for Outdoors:</strong> {{ weatherData.ai_insights.travel_recommendations.best_time_for_outdoors }}</p>
                              <p><strong>Clothing Suggestions:</strong></p>
                              <ul>
                                  <li *ngFor="let suggestion of weatherData.ai_insights.travel_recommendations.clothing_suggestions">{{ suggestion }}</li>
                              </ul>
                              <p><strong>Travel Precautions:</strong></p>
                              <ul>
                                  <li *ngFor="let precaution of weatherData.ai_insights.travel_recommendations.travel_precautions">{{ precaution }}</li>
                              </ul>
                          </ng-container>
                      </ng-container>
                  </div>
              </div>
          </div>
      </div>
  
      <div *ngIf="error && !isLoading" class="error-message">
          <p>{{ error }}</p>
      </div>
  </div>
</body>
</html>